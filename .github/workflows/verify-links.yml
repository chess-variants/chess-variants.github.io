name: Verify External Links

on:
  # Run on the first day of every month at 00:00 UTC
  schedule:
    - cron: '0 0 1 * *'

  # Allow manual trigger
  workflow_dispatch:

jobs:
  verify-links:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install dependencies
        run: |
          pip install -r _scripts/requirements.txt

      - name: Verify links
        id: verify
        run: |
          python _scripts/verify_links.py 2>&1 | tee link-verification-report.txt
          exit ${PIPESTATUS[0]}

      - name: Add report to job summary
        if: always()
        run: |
          echo "# Link Verification Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          cat link-verification-report.txt >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
